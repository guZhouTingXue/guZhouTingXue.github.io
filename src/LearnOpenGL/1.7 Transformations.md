---
category: LearnOpenGL
---
# 1.7 Transformations

## Vectors
> [!info]
> Vectors are directions. A vector has a direction and a magnitude (also known as its strength or length).
> vectors are directions and nothing more

<span style="background:#fff88f">如果向量的属性既带有direction 又 带有 magnitude，那么它就不只是direction，而是在指定方向上移动的距离。</span>

:::tabs
@tab 效果
![|400x357](./attachments/1.7%20Transformations.webp)
@tab 实现
``` 
w=Vector((1,3),(4,5))
n=Vector((6,3),(3,3))
v=Vector((3,2))
```
:::

>[!info]
>Since vectors represent directions, the origin of  the vector does not change its value. 

向量的值仅和其指向以及长度有关，上图中 $\vec{w}$ 和 $\vec{v}$ 虽然起点 和 终点不同，但是它们的指向（方向+距离）相同，所以它们是同一向量。

关于指向：上图中的文本（3，2）表示向x轴正方向移动3个单位长度，向y轴正方向移动2个单位长度。

由于vector 只表示指向，可以有无数个vector表示同一指向。为了具体地描述向量，选择起点为原点的向量代表该指向。原点作为默认起点，此时向量的终点就可以表示该向量。

$$
\vec{v}=\begin{pmatrix}x\\y\\z\end{pmatrix}
$$


### Addition
![|500x283](./attachments/1.7%20Transformations-1.webp)

$\vec{t}$ 和 $\vec{v}$ 是相等向量
对两个向量相加，相当于从原点出发，先按照第一个向量的方向前进，然后再按照第二个向量的方向前进。

### Vector negation
>[!info]
>Negating a vector results in a vector in the reversed direction.

$$
-\vec{v} = -\begin{pmatrix} v_x \\ v_y \\ v_z \end{pmatrix} 
= \begin{pmatrix} -v_x \\ -v_y \\ - v_z \end{pmatrix}
$$
### Subtraction
![|498x327](./attachments/1.7%20Transformations-2.webp)

先按照第一个向量的方向前进，然后按照第二个向量的相反向量前进。

$$
\vec{w} - \vec{v} = \vec{w} + - \vec{v} 
$$
减去一个向量相当于和它的相反向量相加
### Scalar vector operations
$$
\begin{pmatrix} 1 \\ 2 \\ 3 \end{pmatrix} 
+ x \to \begin{pmatrix} 1 \\ 2 \\ 3 \end{pmatrix} 
+ \begin{pmatrix} x \\ x \\ x \end{pmatrix}
+ = \begin{pmatrix} 1 + x \\ 2 + x \\ 3 + x \end{pmatrix}
$$
每个方向上进行放大或缩小


### Length
![|296x180](./attachments/1.7%20Transformations-3.webp)

$$
||\vec{v}|| = \sqrt{x^2 + y^2}
$$
**unit vector**
和目标向量指向方向相同，但是长度为1的向量称为 `unit vector` 
计算：
$$
\hat{n} = { \vec{v} \over  | |v| | }
$$


## Vector-vector multiplication

### Dot product
$$
\vec{v} \cdot \vec{k} = ||\vec{v}|| \cdot ||\vec{k}|| \cdot \cos\theta
$$
其中θ 为两个向量的夹角
问：<span style="background:#fff88f">这个角度值的定义？</span>
chatgpt：最小旋转角度，角度值总是在0~180内

公式的几何含义：一个向量在另一个向量上的投影长度 乘以 另一个向量的长度

**作用**
如果 $\vec{v}$ 和 $\vec{k}$ 是unit vector，那么dot product 的值就是 $\cos\theta$ 的值，也就知道了角度值

**计算**
![|504x281](./attachments/1.7%20Transformations-4.webp)

$$
\begin{pmatrix} 2 \\ 2 \end{pmatrix} \cdot \begin{pmatrix} 1 \\ 3 \end{pmatrix}
= 
(2 * 1) + (2 * 3) 
= 
8
$$
$\vec{v}$ 和 g 是垂直的，$\vec{v}$ 和 $\vec{k}$ 在 $\vec{v}$ 上的投影  相同。$\vec{v}$ 的长度为$2\sqrt{2}$ , 平方后就是8
通过坐标计算时，直接将对应的坐标相乘，然后再相加


### Cross product
>[!info]
>The cross product takes two non-parallel vectors as input and produces a third vector that is orthogonal to both the input vectors.

二维向量叉积的结果是：
$$
a \times b = |a||b|\sin \theta
$$
θ：从a逆时针旋转到b的角度
其绝对值表示两个向量组成的平行四边形的面积，如果叉积的结果为负表示夹角大于180°

三维向量中，对于两个不平行的两个向量，其叉积结果是生成一个垂直于两个输入向量（平面）的向量。
![](./attachments/1.7%20Transformations-5.webp)

**计算**
$$
\begin{pmatrix}
\color{red} A_x \\ \color{green} A_y \\ \color{blue} A_z \end{pmatrix}
\times
\begin{pmatrix}\color{red} B_x \\ \color{green} B_y \\ \color{blue} B_z \end{pmatrix}
=
\begin{pmatrix}\color{green} A_y \color{blue}B_z - \color{blue}A_z \color{green}B_y\\ \color{blue} A_z \color{red}B_x - \color{red}A_x \color{blue}B_z\\ 
\color{red} A_x \color{green}B_y - \color{green}A_y \color{red}B_x
\end{pmatrix}
$$


## Matrices
>[!info]
>A matrix is a rectangular array of numbers, symbols and/or mathematical expressions. Each individual item in a matrix is called an element of the matrix.
>Matrices are indexed by (i,j) where i is the row and j is the column.

一个2行3列的矩阵
$$
\begin{bmatrix}
1 & 2 & 3 \\
4 & 5 & 6
\end{bmatrix}
$$
- 通过元素在的矩阵中的位置引用元素
- 2行3列的矩阵可以称为 2x3 矩阵
### Addition and subtraction
相同位置的元素对应相加减

### Matrix-scalar products
>[!info]
>A matrix-scalar product multiples each element of the matrix by a scalar.


### Matrix-matrix multiplication
**计算**
$$
\begin{bmatrix}
\color{red}1 & \color{red} 2 & \color{red} 3 \\
\color{green}4 & \color{green} 5 & \color{green} 6 
\end{bmatrix}
\cdot
\begin{bmatrix}
\color{blue}1 & \color{purple} 2  \\
\color{blue} 3 & \color{purple} 4 \\
\color{blue} 5 & \color{purple} 6
\end{bmatrix}
= 
\begin{bmatrix}
\color{red}\boxed{ 1*1 + 2*3 + 3*5} & 1*2 + 2*4 + 3*6 \\
4*1 + 5*3 + 6*5 & 4*2 + 5*4 + 6*6
\end{bmatrix}
$$
两个矩阵相乘要求第一个矩阵的列数和第二个矩阵的行数相同
由上面的计算方式可知，矩阵的乘法不满足交换律即：
$$
A*B \not= B*A
$$

>[!info]
>Matrix multiplication is not commutative.

### Matrix-Vector multiplication
>[!info]
>A vector is basically a Nx1 matrix where N is the vector's number of components (also known as an N-dimensional vector).

向量可以看作是N行1列的矩阵（反过来矩阵可以看作是NxM的矩阵 可以看作是由M 个Nx1 的向量构成的。
### Identify matrix
>[!info]
>The identify matrix is an NxN matrix with only 0s except on its diagonal.

$$
\begin{bmatrix}
\color{red} 1 & 0 & 0 & 0 \\
0 & \color{red} 1 & 0 & 0 \\
0 & 0 & \color{red} 1 & 0 \\
0 & 0 & 0 & \color{red} 1
\end{bmatrix}
$$

>[!info]
>The identity matrix is usually a starting point of generating other transformation matrices

## 应用矩阵进行变换
### Scaling
![|350x333](./attachments/1.7%20Transformations-6.webp)

将向量 $\vec{v}$ 的 x 方向值缩小一半，y方向值放大一倍 后得到 向量 $\vec{s}$ 
>[!info]
> If we represent the scaling variables as (S1,S2,S3) we can define a scaling matrix on any vector (x,y,z) as:

$$
\begin{bmatrix} \color{red}{S_1} & \color{red}0 & \color{red}0 & \color{red}0 \\ \color{green}0 & \color{green}{S_2} & \color{green}0 & \color{green}0 \\ \color{blue}0 & \color{blue}0 & \color{blue}{S_3} & \color{blue}0 \\ \color{purple}0 & \color{purple}0 & \color{purple}0 & \color{purple}1 \end{bmatrix} \cdot \begin{pmatrix} x \\ y \\ z \\ 1 \end{pmatrix} = \begin{pmatrix} \color{red}{S_1} \cdot x \\ \color{green}{S_2} \cdot y \\ \color{blue}{S_3} \cdot z \\ 1 \end{pmatrix}
  
$$
在单位矩阵的基础上，对角线上第一（n）行的元素对应第一（n）个维度的缩放值

### Translation
>[!info]
>Moving the vector based on a translation vector.

$$
\begin{bmatrix} \color{red}1 & \color{red}0 & \color{red}0 & \color{red}{T_x} \\ \color{green}0 & \color{green}1 & \color{green}0 & \color{green}{T_y} \\ \color{blue}0 & \color{blue}0 & \color{blue}1 & \color{blue}{T_z} \\ \color{purple}0 & \color{purple}0 & \color{purple}0 & \color{purple}1 \end{bmatrix} \cdot \begin{pmatrix} x \\ y \\ z \\ 1 \end{pmatrix} = \begin{pmatrix} x + \color{red}{T_x} \\ y + \color{green}{T_y} \\ z + \color{blue}{T_z} \\ 1 \end{pmatrix}
$$
T<sub>x</sub> 表示x方向移动的距离

4维向量中的最后一个分量 w 称为齐次坐标 **Homogeneous coordinates**，有了这个分量就可以用矩阵对x，y，z作加减了。
w的值通常为1。如果w为0，则不能进行translation，此时 该vector仅用来表示方向。

### Rotation
暂略

### Combining matrices
>[!info]
>We can combine multiple transformations in a single matrix thanks to matrix-matrix multiplication.

$$
 Trans . Scale = \begin{bmatrix} \color{red}1 & \color{red}0 & \color{red}0 & \color{red}1 \\ \color{green}0 & \color{green}1 & \color{green}0 & \color{green}2 \\ \color{blue}0 & \color{blue}0 & \color{blue}1 & \color{blue}3 \\ \color{purple}0 & \color{purple}0 & \color{purple}0 & \color{purple}1 \end{bmatrix} . \begin{bmatrix} \color{red}2 & \color{red}0 & \color{red}0 & \color{red}0 \\ \color{green}0 & \color{green}2 & \color{green}0 & \color{green}0 \\ \color{blue}0 & \color{blue}0 & \color{blue}2 & \color{blue}0 \\ \color{purple}0 & \color{purple}0 & \color{purple}0 & \color{purple}1 \end{bmatrix} = \begin{bmatrix} \color{red}2 & \color{red}0 & \color{red}0 & \color{red}1 \\ \color{green}0 & \color{green}2 & \color{green}0 & \color{green}2 \\ \color{blue}0 & \color{blue}0 & \color{blue}2 & \color{blue}3 \\ \color{purple}0 & \color{purple}0 & \color{purple}0 & \color{purple}1 \end{bmatrix} 
$$
先放大后移动
使用合并后的矩阵对向量作变换：
$$
\begin{bmatrix} \color{red}2 & \color{red}0 & \color{red}0 & \color{red}1 \\ \color{green}0 & \color{green}2 & \color{green}0 & \color{green}2 \\ \color{blue}0 & \color{blue}0 & \color{blue}2 & \color{blue}3 \\ \color{purple}0 & \color{purple}0 & \color{purple}0 & \color{purple}1 \end{bmatrix} . \begin{bmatrix} x \\ y \\ z \\ 1 \end{bmatrix} = \begin{bmatrix} \color{red}2x + \color{red}1 \\ \color{green}2y + \color{green}2  \\ \color{blue}2z + \color{blue}3 \\ 1 \end{bmatrix}
$$
由于矩阵乘法不满足交换律，所以变换的顺序很重要。后进行的变换会对先进行的变换产生影响。
交换变换的顺序后合并得到的矩阵：
$$
Scale . Trans = 
\begin{bmatrix} \color{red}2 & \color{red}0 & \color{red}0 & \color{red}0 \\ \color{green}0 & \color{green}2 & \color{green}0 & \color{green}0 \\ \color{blue}0 & \color{blue}0 & \color{blue}2 & \color{blue}0 \\ \color{purple}0 & \color{purple}0 & \color{purple}0 & \color{purple}1 \end{bmatrix}
. 
\begin{bmatrix} \color{red}1 & \color{red}0 & \color{red}0 & \color{red}1 \\ \color{green}0 & \color{green}1 & \color{green}0 & \color{green}2 \\ \color{blue}0 & \color{blue}0 & \color{blue}1 & \color{blue}3 \\ \color{purple}0 & \color{purple}0 & \color{purple}0 & \color{purple}1 \end{bmatrix} 
=
\begin{bmatrix}
2 & 0 & 0 & 1 \\
0 & 2 & 0 & 4 \\
0 & 0 & 2 & 6 \\
0 & 0 & 0 & 1 
\end{bmatrix}
$$
应用到向量：
$$
\begin{bmatrix}
2 & 0 & 0 & 1 \\
0 & 2 & 0 & 4 \\
0 & 0 & 2 & 6 \\
0 & 0 & 0 & 1 
\end{bmatrix}
.
\begin{bmatrix} x \\ y \\ z \\ 1 \end{bmatrix} 
= 
\begin{bmatrix} \color{red}2x + \color{red}1 \\ \color{green}2y + \color{green}4  \\ \color{blue}2z + \color{blue}6 \\ 1 \end{bmatrix}
$$
可以看到scale的效果应用到了Trans 上

通常变换的顺序为：
>[!info]
>It is advised to first do scaling operations, then rotations and lastly translations when combining matrices


###  Gimbal lock
参考：[无伤理解欧拉角中的“万向死锁”现象 - YouTube](https://www.youtube.com/watch?v=vLDn-ZITDgA)
1. 指定变换顺序 以及 变换角度后就确定了最终的变换矩阵；
2. 在确定了变换的顺序后，用户调整变换角度值的顺序 对 变换的顺序没有影响；

## 相关资源

| 名称            | 内容  |
| ------------- | --- |
| Vectors_0.ggb |     |


