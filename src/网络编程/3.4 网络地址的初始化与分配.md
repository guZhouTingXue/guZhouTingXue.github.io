---
category: 网络编程
---
# 3.4 网络地址的初始化与分配
网络地址使用点分十进制表示，通常以字符串的形式输入网络地址和端口号。在初始化网络地址时需要将其转换为整数值。

转换地址的函数：
``` cpp
   #include <sys/socket.h>
   #include <netinet/in.h>
   #include <arpa/inet.h>

   int inet_aton(const char *cp, struct in_addr *inp);
   in_addr_t inet_addr(const char *cp);
   char *inet_ntoa(struct in_addr in);
```

| 行号  | 功能                                   | 说明                                  |
| --- | ------------------------------------ | ----------------------------------- |
| 5   | 将cp 指向的点分表示的IP地址字符串转换为32位地址，并存储在imp中 | 转换后的地址是network byte order。成功返回非0值.  |
| 6   | 转换字符串地址为32位整数                        |                                     |
| 7   | 将32位整数地址值转换位点分表示法的字符串                |                                     |

inet 应该是表示internet
a：address
n：number？

转换端口：
``` cpp
       #include <stdlib.h>
       int atoi(const char *nptr);
```

>[!quote]
> The atoi() function converts the initial portion of the string pointed to by nptr to int. 

## 初始化
``` cpp
    struct sockaddr_in serv_addr;
	memset(&serv_addr, 0, sizeof(serv_addr));
    serv_addr.sin_family = AF_INET;
    serv_addr.sin_addr.s_addr = inet_addr(argv[1]); 
    serv_addr.sin_port = htons(atoi(argv[2]));
    
	sockaddr->sin_addr.s_addr = htonl(INADDR_ANY);
    sockaddr->sin_port = htons(0);
```

| 行号  | 功能                           | 说明                                                                                                       |
| --- | ---------------------------- | -------------------------------------------------------------------------------------------------------- |
| 1   | 定义IP地址对象                     |                                                                                                          |
| 2   | 将family、address、port 值全部设置为0 | 要求gap 部分全部为0                                                                                             |
| 3   | 设置采用IPv4地址                   |                                                                                                          |
| 4   | 根据传入的参数设置地址                  |                                                                                                          |
| 5   | 设置端口                         |                                                                                                          |
| 7   | 设置地址                         | INADDR_ANY:自动获取本地IP地址，若本地有多个IP，可以从不同IP接收同一端口数据<br>主机有多个IP时，使用ANY设置IP地址，p设置port。发送到主机任意IP地址，p端口 的数据都能被接收。 |
| 8   | 设置端口                         | 自动分配端口                                                                                                   |

## 分配
将IP地址分配给socket
``` cpp
       #include <sys/types.h>          /* See NOTES */
       #include <sys/socket.h>

       int bind(int sockfd, const struct sockaddr *addr,
                socklen_t addrlen);

```


| 参数      | 含义                                              |
| ------- | ----------------------------------------------- |
| sockfd  | 要分配地址的socket                                    |
| addr    | 存有地址信息的地址对象（通常在bind前初始化完成）                      |
| addrlen | addr对象的长度                                       |
| return  | 0：success； -1： error，errno is set appropriately |

问：<mark style="background: #FFF3A3A6;">sockaddr_in 使用gap 填充了部分字节使其和 sockaddr 具有相同大小，为什么这里需要addrlen？</mark>
