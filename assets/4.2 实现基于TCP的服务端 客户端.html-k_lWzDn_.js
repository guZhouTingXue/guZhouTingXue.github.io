import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as l,a as s,f as e,d as a,r as h,o as d}from"./app-DQvNNHqK.js";const r="/assets/4.2%20%E5%AE%9E%E7%8E%B0%E5%9F%BA%E4%BA%8ETCP%E7%9A%84%E6%9C%8D%E5%8A%A1%E7%AB%AF%20%E5%AE%A2%E6%88%B7%E7%AB%AF-C-Q43dZY.webp",k="/assets/4.2%20%E5%AE%9E%E7%8E%B0%E5%9F%BA%E4%BA%8ETCP%E7%9A%84%E6%9C%8D%E5%8A%A1%E7%AB%AF%20%E5%AE%A2%E6%88%B7%E7%AB%AF-1-PV0sYk4H.webp",p="data:image/webp;base64,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",A="/assets/4.2%20%E5%AE%9E%E7%8E%B0%E5%9F%BA%E4%BA%8ETCP%E7%9A%84%E6%9C%8D%E5%8A%A1%E7%AB%AF%20%E5%AE%A2%E6%88%B7%E7%AB%AF-3-CTZzvVbj.webp",o={};function c(g,i){const t=h("Mermaid");return d(),l("div",null,[i[0]||(i[0]=s("h1",{id:"_4-2-实现基于tcp的服务端-客户端",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_4-2-实现基于tcp的服务端-客户端"},[s("span",null,"4.2 实现基于TCP的服务端 客户端")])],-1)),i[1]||(i[1]=s("h2",{id:"服务端",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#服务端"},[s("span",null,"服务端")])],-1)),i[2]||(i[2]=s("p",null,"调用流程：",-1)),e(t,{code:"eJxLy8kvT85ILCrhUgCC4vzk7NSSaAhl9bRj9tPdu54unf6sb+nTtdNjwUqSMvNSokGElcLTjraXrb1P52x4OrcBIpmTWVySmhcNoRSer+18uq/1xf55QP0Q+cTk5NSCkmgI9bS18cW6HcjSReXRRamJKfrlRZklqQrPpm541rvuya4lz3oXQeSTc/KLU6PBpMKzaWuf7mlA1g1xtYKurh3YkWAG1CUgJsRSMLOoHEyBDeICALtnbfs="}),i[3]||(i[3]=a(`<h3 id="进入等待连接请求-监听-状态" tabindex="-1"><a class="header-anchor" href="#进入等待连接请求-监听-状态"><span>进入等待连接请求（监听）状态</span></a></h3><p>使用bind（） 给socket 分配地址后调用listen（）进入等待连接请求状态。</p><div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-cpp"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">       #include</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &lt;sys/types.h&gt;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">          /* See NOTES */</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">       #include</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &lt;sys/socket.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">       int</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> listen</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> sockfd</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> backlog</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th>参数</th><th>含义</th><th>说明</th></tr></thead><tbody><tr><td>sockfd</td><td>要进入等待连接请求状态的socket文件描述符</td><td>socket 类型需要是SOCK_STREAM 或 SOCK_SEQPACKET</td></tr><tr><td>backlog</td><td>连接请求队列的长度</td><td></td></tr><tr><td>return</td><td>是否调用成功</td><td>0：success；-1：error</td></tr></tbody></table><figure><img src="`+r+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>客户端通过connect（）发送建立连接请求，服务端只有在进入监听状态后请求才可以被接收。如果服务端未进入监听状态，客户端connect（）返回错误。<br> 在监听状态下，所有的连接请求都被放入连接请求队列。</p><h3 id="受理客户端连接请求" tabindex="-1"><a class="header-anchor" href="#受理客户端连接请求"><span>受理客户端连接请求</span></a></h3><p>服务端的监听套接字相当于守卫，所有要进行通讯的客户端都要经过守卫。</p><div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-cpp"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">       #include</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &lt;sys/types.h&gt;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">          /* See NOTES */</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">       #include</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &lt;sys/socket.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">       int</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> accept</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> sockfd</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">struct</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> sockaddr</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">addr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">socklen_t</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">addrlen</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th>参数</th><th>含义</th><th>说明</th></tr></thead><tbody><tr><td>sockfd</td><td>处于监听状态的socket</td><td>extracts the first connection request on the queue of pending connections</td></tr><tr><td>addr</td><td>指向sockaddr structure 的指针</td><td>填充为peer socket（发起连接请求的客户端socket）的地址信息</td></tr><tr><td>addrlen</td><td>存储addr structure 的长度指针</td><td>填充addr实际的长度值</td></tr><tr><td>return</td><td>new connected socket</td><td>nonnegative integer：创建一个新的 和 当前处理的socket 进行通信的socket；-1：error</td></tr></tbody></table><figure><img src="`+k+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="客户端" tabindex="-1"><a class="header-anchor" href="#客户端"><span>客户端</span></a></h2><p>调用流程：</p>',13)),e(t,{code:"eJxLy8kvT85ILCpR4FIAguL85OzUkmgIZfW0Y/bT3bueLp3+rG/p07XTY7k4k/Pz8lKTS6KhtNWL9dufbWx6sX8eUAVQuqg8uig1MUW/vCizJFXhya4lz3oXPZu64VnvOpDenPzi1GgwqfBs2tqnexrg+iD2Kejq2ilATQazi8ohQmAtXAC1xEw/"}),i[4]||(i[4]=a(`<div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-cpp"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">       #include</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &lt;sys/types.h&gt;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">          /* See NOTES */</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">       #include</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &lt;sys/socket.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">       int</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> connect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> sockfd</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> sockaddr</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">addr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">                   socklen_t</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> addrlen</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th>参数</th><th>含义</th><th>说明</th></tr></thead><tbody><tr><td>sockfd</td><td>发送连接请求的socket</td><td></td></tr><tr><td>addr</td><td>服务端socket 地址信息</td><td></td></tr><tr><td>addrlen</td><td>servaddr structure长度</td><td></td></tr></tbody></table><blockquote><p>[!quote]<br> 客户端套接字地址信息在哪？<br> 何时？调用connect 函数时<br> 何地？ 操作系统，更准确地说是在内核中<br> 如何？ IP用计算机（主机）的IP，端口随机</p></blockquote><p>可以设置客户端的socket绑定的地址：<br><img src="`+p+'" alt="" loading="lazy"><br> 问：<mark style="background:#FFF3A3A6;">如何实现？</mark></p><h2 id="基于tcp的服务器-客户端函数调用关系" tabindex="-1"><a class="header-anchor" href="#基于tcp的服务器-客户端函数调用关系"><span>基于TCP的服务器/客户端函数调用关系</span></a></h2><p><img src="'+A+'" alt="|384x413" loading="lazy"><br> 客户端发送连接请求时，服务端可能还没有调用accept。如果已经调用accept，但是请求队列中还没有socket，那么accpet（）进入阻塞状态，直到有客户端发送连接请求。</p>',6))])}const y=n(o,[["render",c]]),B=JSON.parse('{"path":"/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/4.2%20%E5%AE%9E%E7%8E%B0%E5%9F%BA%E4%BA%8ETCP%E7%9A%84%E6%9C%8D%E5%8A%A1%E7%AB%AF%20%E5%AE%A2%E6%88%B7%E7%AB%AF.html","title":"4.2 实现基于TCP的服务端 客户端","lang":"zh-CN","frontmatter":{"category":"网络编程","description":"4.2 实现基于TCP的服务端 客户端 服务端 调用流程： 进入等待连接请求（监听）状态 使用bind（） 给socket 分配地址后调用listen（）进入等待连接请求状态。 客户端通过connect（）发送建立连接请求，服务端只有在进入监听状态后请求才可以被接收。如果服务端未进入监听状态，客户端connect（）返回错误。 在监听状态下，所有的连接...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"4.2 实现基于TCP的服务端 客户端\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-10-05T14:57:08.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"mingStudent\\"}]}"],["meta",{"property":"og:url","content":"https://guzhoutingxue.github.io/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/4.2%20%E5%AE%9E%E7%8E%B0%E5%9F%BA%E4%BA%8ETCP%E7%9A%84%E6%9C%8D%E5%8A%A1%E7%AB%AF%20%E5%AE%A2%E6%88%B7%E7%AB%AF.html"}],["meta",{"property":"og:title","content":"4.2 实现基于TCP的服务端 客户端"}],["meta",{"property":"og:description","content":"4.2 实现基于TCP的服务端 客户端 服务端 调用流程： 进入等待连接请求（监听）状态 使用bind（） 给socket 分配地址后调用listen（）进入等待连接请求状态。 客户端通过connect（）发送建立连接请求，服务端只有在进入监听状态后请求才可以被接收。如果服务端未进入监听状态，客户端connect（）返回错误。 在监听状态下，所有的连接..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-10-05T14:57:08.000Z"}],["meta",{"property":"article:modified_time","content":"2025-10-05T14:57:08.000Z"}]]},"git":{"createdTime":1759676228000,"updatedTime":1759676228000,"contributors":[{"name":"guZhouTingXue","username":"guZhouTingXue","email":"2422173022@qq.com","commits":1,"url":"https://github.com/guZhouTingXue"}]},"readingTime":{"minutes":2.39,"words":716},"filePathRelative":"网络编程/4.2 实现基于TCP的服务端 客户端.md","excerpt":"","autoDesc":true}');export{y as comp,B as data};
