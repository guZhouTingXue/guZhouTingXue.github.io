import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,d as n,o as l}from"./app-D7TihOFE.js";const t={};function h(e,s){return l(),a("div",null,[...s[0]||(s[0]=[n(`<h1 id="_10-3-信号处理" tabindex="-1"><a class="header-anchor" href="#_10-3-信号处理"><span>10.3 信号处理</span></a></h1><ul><li>父进程往往和子进程一样繁忙，因此不能只调用waitpid函数以等待子进程终止：父进程需要在子进程结束时收到通知，然后进行相关后续处理</li><li>子进程终止的识别主体是操作系统：操作系统管理进程的运行状态</li><li>“信号”是在特定事件发生时由操作系统向进程发送的消息：子进程结束属于特定事件，可以由操作系统通过“信号”通知其父进程</li><li>为了响应该消息，执行与消息相关的自定义操作的过程称为“处理” 或 “信号处理”</li></ul><h2 id="sigaction" tabindex="-1"><a class="header-anchor" href="#sigaction"><span>sigaction</span></a></h2><div class="language-cpp line-numbers-mode has-collapsed-lines collapsed" data-highlighter="shiki" data-ext="cpp" style="--vp-collapsed-lines:15;--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-cpp"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">NAME</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">       sigaction, rt_sigaction </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> examine </span><span style="--shiki-light:#A626A4;--shiki-dark:#ABB2BF;">and</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> change a signal action</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">SYNOPSIS</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">       #include</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &lt;signal.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">       int</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> sigaction</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> signum</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> sigaction</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">act</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                     struct</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> sigaction</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">oldact</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                     </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        The sigaction structure is defined as something like:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	   struct</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> sigaction</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		   void</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">     (*</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">sa_handler</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		   void</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">     (*</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">sa_sigaction</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">siginfo_t</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">		   sigset_t</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   sa_mask;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		   int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        sa_flags;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		   void</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">     (*</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">sa_restorer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	   };</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="collapsed-lines"></div></div><table><thead><tr><th>参数</th><th>值</th><th>用途</th><th>说明</th></tr></thead><tbody><tr><td>signum</td><td></td><td>specifies the signal and can be any valid signal except SIGKILL and SIGSTOP.</td><td></td></tr><tr><td>act</td><td></td><td>If act is non-NULL, the new action for signal signum is installed from act.</td><td></td></tr><tr><td>oldact</td><td></td><td>If oldact is non-NULL, the previous action is<br> saved in oldact.<br></td><td></td></tr></tbody></table><p>结构体sigaction中成员的含义</p><table><thead><tr><th>参数</th><th>值</th><th>用途</th><th>说明</th></tr></thead><tbody><tr><td>sa_handler</td><td>SIG_DFL: default action;<br>SIG_IGN: ignore this signal;<br>pointer: 函数指针，指向的函数接收signum作为参数，对信号进行处理</td><td>sa_handler specifies the action to be associated with signum</td><td></td></tr><tr><td>sa_mask</td><td></td><td>sa_mask specifies a mask of signals which should be blocked</td><td></td></tr><tr><td>sa_flags</td><td>SA_NOCLDSTOP： If signum is SIGCHLD, do not receive notification when child processes stop <br>SA_NODEFER：Do not prevent the signal from being received from within its own signal handler.</td><td>specifies a set of flags which modify the behavior of the signal.</td><td>信号处理默认不可中断，不能嵌套（调用自身）。如果有新的信号产生，会排队，等待当前信号处理完毕然后再处理新的信号。设置SA_NODEFER后会先处理新的信号后处理旧的信号。</td></tr></tbody></table><p><span style="background:#fff88f;">问：</span>能不能在信号处理中产生信号？</p><p>通过<code>man 7 signal</code> 查看支持的信号：</p><div class="language-bash line-numbers-mode has-collapsed-lines collapsed" data-highlighter="shiki" data-ext="bash" style="--vp-collapsed-lines:15;--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   Signal</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     Value</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     Action</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   Comment</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       ──────────────────────────────────────────────────────────────────────</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       SIGHUP</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       Term</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    Hangup</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> detected</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> on</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> controlling</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> terminal</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                                     or</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> death</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> of</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> controlling</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> process</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       SIGINT</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       Term</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    Interrupt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> keyboard</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       SIGQUIT</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">       3</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       Core</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    Quit</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> keyboard</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       SIGILL</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       Core</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    Illegal</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Instruction</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       SIGABRT</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">       6</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       Core</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    Abort</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> signal</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> abort</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       SIGFPE</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       Core</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    Floating</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> point</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> exception</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       SIGKILL</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">       9</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       Term</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    Kill</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> signal</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       SIGSEGV</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      11</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       Core</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    Invalid</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> memory</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> reference</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       SIGPIPE</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      13</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       Term</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    Broken</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pipe:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> write</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pipe</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> with</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> no</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                                     readers</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       SIGALRM</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      14</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       Term</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    Timer</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> signal</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> alarm</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       SIGTERM</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      15</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       Term</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    Termination</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> signal</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       SIGUSR1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   30,10,16</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    Term</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    User-defined</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> signal</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       SIGUSR2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   31,12,17</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    Term</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    User-defined</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> signal</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       SIGCHLD</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   20,17,18</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    Ign</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     Child</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stopped</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> or</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> terminated</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       SIGCONT</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   19,18,25</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    Cont</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    Continue</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> if</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stopped</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       SIGSTOP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   17,19,23</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    Stop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    Stop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> process</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       SIGTSTP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   18,20,24</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    Stop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    Stop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> typed</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> at</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> terminal</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       SIGTTIN</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   21,21,26</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    Stop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    Terminal</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> input</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> for</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> background</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> process</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       SIGTTOU</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   22,22,27</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    Stop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    Terminal</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> output</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> for</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> background</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> process</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">       </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">	   SIGURG</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      16,23,21</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    Ign</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     Urgent</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> condition</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> on</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> socket</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (4.2BSD)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       SIGVTALRM</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   26,26,28</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    Term</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    Virtual</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> alarm</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> clock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (4.2BSD)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="collapsed-lines"></div></div><p>action描述接收信号后进程的默认行为：</p><table><thead><tr><th>行为</th><th>说明</th></tr></thead><tbody><tr><td>Term</td><td>终止进程</td></tr><tr><td>Core</td><td>终止进程并核心转储</td></tr><tr><td>Ign</td><td>忽略该信号</td></tr><tr><td>Cont</td><td>继续执行</td></tr><tr><td>Stop</td><td>暂停</td></tr></tbody></table><h3 id="alarm" tabindex="-1"><a class="header-anchor" href="#alarm"><span>alarm</span></a></h3><p>信号列表中有一个 <code>SIGALRM</code> ，在通过alarm产生的Timer 计时结束后触发该信号。</p><div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-cpp"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">NAME</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">       alarm </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> set an alarm clock </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> delivery of a signal</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">SYNOPSIS</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">       #include</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &lt;unistd.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">       unsigned</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> alarm</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">unsigned</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> seconds</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th>参数</th><th>值</th><th>用途</th><th>说明</th></tr></thead><tbody><tr><td>seconds</td><td></td><td>设定的倒计时</td><td>从调用alarm开始计时，到达seconds 后触发SIGALRM 信号。如果seconds 为0，所有未触发的timer 都会被取消（停止计时，不会触发SIGALRM 信号）</td></tr><tr><td>RETURN VALUE</td><td></td><td>获取之前设定的倒计时剩余秒数</td><td></td></tr></tbody></table><p>新的alarm 会取消之前设定的Timer 或者说是覆盖掉（重新计时）</p><p><strong>测试</strong><br> 处理通过alarm（）触发的 <code>SIGALRM</code> 信号<br> 实现：</p><div class="language-cpp line-numbers-mode has-collapsed-lines collapsed" data-highlighter="shiki" data-ext="cpp" style="--vp-collapsed-lines:15;--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-cpp"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> timeout</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> sig</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(sig </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">==</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> SIGALRM)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        puts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;time out!&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> argc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">char*</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> argv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[])</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    struct</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> sigaction</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> act</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    act</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">sa_handler</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> timeout;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    sigemptyset</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#56B6C2;">&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">act</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">sa_mask</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    act</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">sa_flags</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    sigaction</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(SIGALRM, </span><span style="--shiki-light:#A626A4;--shiki-dark:#56B6C2;">&amp;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">act, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    alarm</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    printf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;sleeping for 5 seconds...</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    sleep</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    printf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;wake up</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="collapsed-lines"></div></div><table><thead><tr><th>行号</th><th>功能</th><th>说明</th></tr></thead><tbody><tr><td>1-5</td><td>定义信号处理函数</td><td>收到SIGALRM 时打印提示信息</td></tr><tr><td>12</td><td>将sa_mask清空</td><td>接收所有信号</td></tr><tr><td>14</td><td>设置信号处理的对象</td><td></td></tr><tr><td>16</td><td>开始计时</td><td></td></tr><tr><td>18</td><td>让进程休眠</td><td>休眠时间大于时钟时间</td></tr></tbody></table><p>效果：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>sleeping for 5 seconds...</span></span>
<span class="line"><span>time out!</span></span>
<span class="line"><span>wake up</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>触发了SIGALRM信号，休眠的进程被唤醒处理信号。</p><p><strong>其他特性测试</strong></p><ol><li>后设置的alarm 会取消前面设置的alarm<br> 实现：</li></ol><div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-cpp"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    alarm</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    alarm</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>效果：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>sleeping for 5 seconds...</span></span>
<span class="line"><span>time out!</span></span>
<span class="line"><span>wake up</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>只打印了一次time out</p><ol start="2"><li>seconds 为0时，any pending alarm is canceled<br> 实现：</li></ol><div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-cpp"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">	alarm</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">	alarm</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>效果：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>sleeping for 5 seconds...</span></span>
<span class="line"><span>wake up</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>没有SIGALRM信号</p>`,34)])])}const d=i(t,[["render",h]]),r=JSON.parse('{"path":"/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/10.3%20%E4%BF%A1%E5%8F%B7%E5%A4%84%E7%90%86.html","title":"10.3 信号处理","lang":"zh-CN","frontmatter":{"category":"网络编程","description":"10.3 信号处理 父进程往往和子进程一样繁忙，因此不能只调用waitpid函数以等待子进程终止：父进程需要在子进程结束时收到通知，然后进行相关后续处理 子进程终止的识别主体是操作系统：操作系统管理进程的运行状态 “信号”是在特定事件发生时由操作系统向进程发送的消息：子进程结束属于特定事件，可以由操作系统通过“信号”通知其父进程 为了响应该消息，执行与...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"10.3 信号处理\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-12-26T17:40:11.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"mingStudent\\"}]}"],["meta",{"property":"og:url","content":"https://guzhoutingxue.github.io/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/10.3%20%E4%BF%A1%E5%8F%B7%E5%A4%84%E7%90%86.html"}],["meta",{"property":"og:title","content":"10.3 信号处理"}],["meta",{"property":"og:description","content":"10.3 信号处理 父进程往往和子进程一样繁忙，因此不能只调用waitpid函数以等待子进程终止：父进程需要在子进程结束时收到通知，然后进行相关后续处理 子进程终止的识别主体是操作系统：操作系统管理进程的运行状态 “信号”是在特定事件发生时由操作系统向进程发送的消息：子进程结束属于特定事件，可以由操作系统通过“信号”通知其父进程 为了响应该消息，执行与..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-12-26T17:40:11.000Z"}],["meta",{"property":"article:modified_time","content":"2025-12-26T17:40:11.000Z"}]]},"git":{"createdTime":1765475784000,"updatedTime":1766770811000,"contributors":[{"name":"guZhouTingXue","username":"guZhouTingXue","email":"2422173022@qq.com","commits":3,"url":"https://github.com/guZhouTingXue"}]},"readingTime":{"minutes":3.65,"words":1095},"filePathRelative":"网络编程/10.3 信号处理.md","excerpt":"","autoDesc":true}');export{d as comp,r as data};
