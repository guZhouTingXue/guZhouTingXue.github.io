import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,d as e,o as n}from"./app-Cln5UKuS.js";const l="data:image/webp;base64,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",t={};function p(h,s){return n(),a("div",null,[...s[0]||(s[0]=[e(`<h1 id="_16-1-分离i-o流" tabindex="-1"><a class="header-anchor" href="#_16-1-分离i-o流"><span>16.1 分离I/O流</span></a></h1><p>分离I/O流的两种方法：</p><ol><li>通过fork复制文件描述符，区分输入和输出使用的文件描述符；</li><li>通过以不同的方式调用fdopen，创建读模式FILE 和 写模式FILE。</li></ol><p>分离后都能降低实现难度、提高性能</p><h2 id="流-分离带来的eof问题" tabindex="-1"><a class="header-anchor" href="#流-分离带来的eof问题"><span>”流“分离带来的EOF问题</span></a></h2><p>使用标准I/O函数时如何进行半关闭？<br> 使用第一种分离I/O流的方法时，通过 <code>shutdown(int sockfd, int how);</code> 关闭输出流</p><ol><li>能否通过fclose 关闭写模式FILE达到半关闭的目的？（仍可通过读模式FILE接收数据）</li><li>能否仍然使用 <code>shutdown</code> 关闭输出流？</li></ol><p>首先看以下使用fclose 关闭输出流的效果<br> 实现：</p><div class="language-cpp line-numbers-mode has-collapsed-lines collapsed" data-highlighter="shiki" data-ext="cpp" style="--vp-collapsed-lines:15;--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-cpp"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//建立连接</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    FILE </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">readfp </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> fdopen</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(clnt_sock, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;r&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    FILE </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">writefp </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> fdopen</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(clnt_sock, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;w&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    fputs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Hello World!</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, writefp);</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    fputs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Welcome to server.</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, writefp);</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    fflush</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(writefp);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    fclose</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(writefp);</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    fputs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;closed writefp</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, stdout);</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    sleep</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    fgets</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(message, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">sizeof</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(message), readfp);</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    fputs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(message, stdout);</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    fclose</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(readfp);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    close</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(serv_sock);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="collapsed-lines"></div></div><p>效果：</p><ol><li><p>PSH 和 FIN 基本是连着，也就是刚刚fflush，调用fclose就立即发送了FIN<br><img src="`+l+`" alt="" loading="lazy"><br> 12 为 PSH，ACK 13为 FIN，ACK</p></li><li><p>增加sleep，观察<code>fclose(writefp);</code> 前后进程打开的文件<br> 前：</p></li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>Network 3211 ming    2u   CHR  136,8      0t0     11 /dev/pts/8</span></span>
<span class="line"><span>Network 3211 ming    3u  IPv4  31005      0t0    TCP *:10086 (LISTEN)</span></span>
<span class="line"><span>Network 3211 ming    4u  IPv4  31006      0t0    TCP 192.168.56.101:10086-&gt;192.168.56.1:9442 (ESTABLISHED)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>后：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>Network 3211 ming    2u   CHR  136,8      0t0     11 /dev/pts/8</span></span>
<span class="line"><span>Network 3211 ming    3u  IPv4  31005      0t0    TCP *:10086 (LISTEN)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>fclose</li></ol><div class="hint-container info"><p class="hint-container-title">相关信息</p><p>The fclose() function flushes the stream pointed to by stream (writing any buffered<br> output data using fflush(3)) and closes the under-lying file descriptor.</p></div><p>fclose会关闭底层的fd</p><div class="hint-container info"><p class="hint-container-title">相关信息</p><p>fclose(writefd) 完全终止了套接字，而不是半关闭</p></div><p><strong>可以使用shutdown进行半关闭</strong></p><div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-cpp"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    shutdown</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(clnt_sock, SHUT_WR);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    fgets</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(message, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">sizeof</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(message), readfp);</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    //...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,20)])])}const k=i(t,[["render",p]]),o=JSON.parse('{"path":"/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/16.1%20%E5%88%86%E7%A6%BBIO%E6%B5%81.html","title":"16.1 分离I/O流","lang":"zh-CN","frontmatter":{"category":"网络编程","description":"16.1 分离I/O流 分离I/O流的两种方法： 通过fork复制文件描述符，区分输入和输出使用的文件描述符； 通过以不同的方式调用fdopen，创建读模式FILE 和 写模式FILE。 分离后都能降低实现难度、提高性能 ”流“分离带来的EOF问题 使用标准I/O函数时如何进行半关闭？ 使用第一种分离I/O流的方法时，通过 shutdown(int s...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"16.1 分离I/O流\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-12-30T14:17:30.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"mingStudent\\"}]}"],["meta",{"property":"og:url","content":"https://guzhoutingxue.github.io/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/16.1%20%E5%88%86%E7%A6%BBIO%E6%B5%81.html"}],["meta",{"property":"og:title","content":"16.1 分离I/O流"}],["meta",{"property":"og:description","content":"16.1 分离I/O流 分离I/O流的两种方法： 通过fork复制文件描述符，区分输入和输出使用的文件描述符； 通过以不同的方式调用fdopen，创建读模式FILE 和 写模式FILE。 分离后都能降低实现难度、提高性能 ”流“分离带来的EOF问题 使用标准I/O函数时如何进行半关闭？ 使用第一种分离I/O流的方法时，通过 shutdown(int s..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-12-30T14:17:30.000Z"}],["meta",{"property":"article:modified_time","content":"2025-12-30T14:17:30.000Z"}]]},"git":{"createdTime":1767104250000,"updatedTime":1767104250000,"contributors":[{"name":"guZhouTingXue","username":"guZhouTingXue","email":"2422173022@qq.com","commits":1,"url":"https://github.com/guZhouTingXue"}]},"readingTime":{"minutes":1.44,"words":432},"filePathRelative":"网络编程/16.1 分离IO流.md","excerpt":"","autoDesc":true}');export{k as comp,o as data};
