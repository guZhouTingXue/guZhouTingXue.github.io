import{_ as r}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as A,d as l,f as h,a as i,w as n,e as a,r as p,o as g}from"./app-DfW-2e5v.js";const c="/assets/15%20%E5%A5%97%E6%8E%A5%E5%AD%97%E5%92%8C%E6%A0%87%E5%87%86IO-CrbzsHVa.webp",o="/assets/15%20%E5%A5%97%E6%8E%A5%E5%AD%97%E5%92%8C%E6%A0%87%E5%87%86IO-1--hIuTPiX.webp",B={},u={style:{background:"#fff88f"}};function y(F,s){const k=p("Tabs"),d=p("font");return g(),A("div",null,[s[6]||(s[6]=l(`<h1 id="_15-套接字和标准i-o" tabindex="-1"><a class="header-anchor" href="#_15-套接字和标准i-o"><span>15 套接字和标准I/O</span></a></h1><h2 id="标准i-o函数的优点" tabindex="-1"><a class="header-anchor" href="#标准i-o函数的优点"><span>标准I/O函数的优点</span></a></h2><p>标准I/O函数和非标准I/O函数的区别</p><ul><li>标准：按照ANSI C标准定义，具有良好的移植性</li><li>带缓冲：标准I/O函数带有输入、输出缓冲，能够提高性能</li></ul><p>socket缓冲和标准I/O缓冲区别：<br> socket 缓冲的主要目的是为了实现TCP协议而设立的，TCP传输丢失数据时需要重新传输，那么之前传输的数据（丢失的数据）需要缓存，缓存的位置就是socket的输出缓冲。<br> 标准I/O缓冲的目的是提高性能</p><p><strong>性能提升的体现</strong></p><div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-cpp"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> i</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; i</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; i</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">++</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        write</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(sock, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;a&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	FILE </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">fp </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> fdopen</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(sock, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;w&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> i</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; i</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; i</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">++</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">		fputs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;a&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, fp);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    fflush</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(fp);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th>行号</th><th>功能</th><th>说明</th></tr></thead><tbody><tr><td>1-4</td><td>通过非标准I/O函数write写入数据</td><td></td></tr><tr><td>6</td><td>将fd转换为FILE结构体指针</td><td></td></tr><tr><td>7-10</td><td>通过标准IO函数fputs写入</td><td></td></tr><tr><td>11</td><td>刷新缓冲</td><td>如果不进行刷新，那么存在于标准IO缓冲中的数据不会写入到socket的缓冲中，也就是不会被发送</td></tr><tr><td>效果：</td><td></td><td></td></tr></tbody></table>`,8)),h(k,{data:[{id:"write"},{id:"fputs"}]},{title0:n(({value:t,isActive:e})=>[...s[0]||(s[0]=[a("write",-1)])]),title1:n(({value:t,isActive:e})=>[...s[1]||(s[1]=[a("fputs",-1)])]),tab0:n(({value:t,isActive:e})=>[...s[2]||(s[2]=[i("p",null,[i("img",{src:c,alt:"",loading:"lazy"}),i("br"),a(" 循环10次写入的字符a，分为两包发送，第一包数据长度为1，第二包数据长度为9"),i("br"),a(" 这里是开启了Nagle 算法，如果关闭Nagle，那么总的数据包数量是10")],-1)])]),tab1:n(({value:t,isActive:e})=>[...s[3]||(s[3]=[i("p",null,[i("img",{src:o,alt:"",loading:"lazy"}),i("br"),a(" 只有一包"),i("br"),a(" 即使关闭Nagle也是一包")],-1)])]),_:1}),s[7]||(s[7]=l(`<p>以上对比使用标准IO（带缓冲）的优点：</p><ul><li>传输的数据量更大：可以将更多的数据写入到标准IO的缓冲中，然后一次性写入到socket中。如果使用write 那么每次写入的大小就是write的大小</li><li>减少数据向（socket）输出缓冲移动的次数：只要数据写入到socket缓冲，那么就可能被发送。并且向socket输出缓冲写入数据也会消耗不少时间。通过标准IO缓冲缓存数据可以减少向下级缓冲（socket）写入的次数，从而提升性能</li></ul><p>书中示例程序：分别使用read、write ；fgets、fputs 拷贝一个大于300M的文本文件，测试执行时间</p><h2 id="标准i-o函数的缺点" tabindex="-1"><a class="header-anchor" href="#标准i-o函数的缺点"><span>标准I/O函数的缺点</span></a></h2><ul><li>不容易进行双向通信：“每次切换读写工作状态时应调用fflush”，从write切换到read 比较好理解，将输出缓冲中的数据输出，然后再进行读取。从read 切换到write 也需要调用fflush。</li><li>可能需要频繁调用fflush</li><li>在fd 和 FILE 之间进行转换</li></ul><h3 id="fflush" tabindex="-1"><a class="header-anchor" href="#fflush"><span>fflush</span></a></h3><div class="language-cpp line-numbers-mode has-collapsed-lines collapsed" data-highlighter="shiki" data-ext="cpp" style="--vp-collapsed-lines:15;--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-cpp"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">NAME</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">       fflush </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> flush a stream</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">SYNOPSIS</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">       #include</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &lt;stdio.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">       int</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> fflush</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">FILE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">stream</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">DESCRIPTION</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">       For  output  streams,  </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">fflush</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()  forces a write of all user</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">space buffered data </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> the given output </span><span style="--shiki-light:#A626A4;--shiki-dark:#ABB2BF;">or</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> update stream via the stream</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;s underlying write function.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       For input streams associated with seekable files (e.g., disk files, but not pipes or terminals), fflush() discards  any  buffered  data  that  has  been fetched from the underlying file, but has not been consumed by the application.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       The open status of the stream is unaffected.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       If the stream argument is NULL, fflush() flushes all open output streams.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="collapsed-lines"></div></div><p><strong>output streams</strong></p><ul><li>user-space buffered data</li><li>underlying write function</li></ul><p><strong>input streams</strong></p><ul><li>seekable files：有起点 和 终点，可定位的文件，如disk files。对于pipes or terminals 我的理解，他们没有终点（或者说只有起点），不知道输入的次数，以及每次输入的长度。每次输入过后都回到起点。</li></ul><h3 id="fd-和-file-之间的转换" tabindex="-1"><a class="header-anchor" href="#fd-和-file-之间的转换"><span>fd 和 FILE 之间的转换</span></a></h3><p><strong>fd -》 FILE</strong></p><div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-cpp"><span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    FILE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">fdopen</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> fd</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> char</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">mode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	Modes </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;w&quot;</span><span style="--shiki-light:#A626A4;--shiki-dark:#ABB2BF;"> or</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;w+&quot;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> do</span><span style="--shiki-light:#A626A4;--shiki-dark:#ABB2BF;"> not</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> cause truncation of  the  </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">file</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.   </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">The</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  file  descriptor  is  </span><span style="--shiki-light:#A626A4;--shiki-dark:#ABB2BF;">not</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> dup</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;ed,  and will be closed when the stream created by fdopen() is closed.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>正常情况下指定打开的mode 为 <code>w</code> 或 <code>w+</code> 会清除文件原有内容<br> 如：<br> 实现：</p><div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-cpp"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    FILE </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">fp1 </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> fopen</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;1.txt&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;w&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    fclose</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(fp1);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>效果：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>ming@ubuntu:/media/sf_share/Network/build$ cat 1.txt</span></span>
<span class="line"><span>hello world!</span></span>
<span class="line"><span>ming@ubuntu:/media/sf_share/Network/build$ ./Network</span></span>
<span class="line"><span>ming@ubuntu:/media/sf_share/Network/build$ cat 1.txt</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1.txt 中的内容被清除</p><p>但是通过fdopen 转换fd，使用 <code>w</code> 或 <code>w+</code> 就不会清除原有内容<br> 实现：</p><div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-cpp"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> fd </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> open</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;1.txt&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, O_RDWR);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    FILE </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">file </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> fdopen</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(fd, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;w+&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    char</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> buf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}; </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    printf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;read:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">%s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">fgets</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(buf, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">sizeof</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(buf), file));</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    fclose</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(file);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>效果：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>ming@ubuntu:/media/sf_share/Network/build$ cat 1.txt</span></span>
<span class="line"><span>hello world!</span></span>
<span class="line"><span>ming@ubuntu:/media/sf_share/Network/build$ ./Network</span></span>
<span class="line"><span>read:hello world!</span></span>
<span class="line"><span> ming@ubuntu:/media/sf_share/Network/build$ cat 1.txt</span></span>
<span class="line"><span>hello world!</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>FILE -》 fd</strong></p><div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-cpp"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    int</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> fileno</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">FILE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">stream</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   The function </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">fileno</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() examines the argument stream </span><span style="--shiki-light:#A626A4;--shiki-dark:#ABB2BF;">and</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> returns its integer descriptor.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="基于套接字的标准i-o函数使用" tabindex="-1"><a class="header-anchor" href="#基于套接字的标准i-o函数使用"><span>基于套接字的标准I/O函数使用</span></a></h2><div class="code-block-with-title"><div class="code-block-title-bar" data-title="echo_stdserv.c"><span>echo_stdserv.c</span></div><div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-cpp"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	clnt_sock </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> accept</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(...);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	readfp </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> fdopen</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(clnt_sock, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;r&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	writefp </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> fdopen</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(clnt_sock, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;w&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	while</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">feof</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(readfp))</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	{</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">		fgets</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(message, BUF_SIZE, readfp);</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">		fputs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(message, writefp);</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">		fflush</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(writefp);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	}</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">	fclose</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(readfp);</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">	fclose</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(writefp);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><table><thead><tr><th>行号</th><th>功能</th><th>说明</th></tr></thead><tbody><tr><td>3</td><td>以只读的方式获取客户端socket 的FILE</td><td></td></tr><tr><td>5</td><td>判断是否断开连接</td><td></td></tr><tr><td>11</td><td>关闭输入流</td><td></td></tr><tr><td>12</td><td>关闭输出流</td><td></td></tr></tbody></table>`,28)),i("p",null,[i("span",u,[h(d,{color:"#ffff00"},{default:n(()=>[...s[4]||(s[4]=[a("问：",-1)])]),_:1})]),s[5]||(s[5]=a("通过fdopen，以两种方式（只读、只写）获取到的FILE 关闭一个，对另一个是否有影响？当打开的流全部关闭时文件被关闭？",-1))])])}const m=r(B,[["render",y]]),f=JSON.parse('{"path":"/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15%20%E5%A5%97%E6%8E%A5%E5%AD%97%E5%92%8C%E6%A0%87%E5%87%86IO.html","title":"15 套接字和标准I/O","lang":"zh-CN","frontmatter":{"category":"网络编程","description":"15 套接字和标准I/O 标准I/O函数的优点 标准I/O函数和非标准I/O函数的区别 标准：按照ANSI C标准定义，具有良好的移植性 带缓冲：标准I/O函数带有输入、输出缓冲，能够提高性能 socket缓冲和标准I/O缓冲区别： socket 缓冲的主要目的是为了实现TCP协议而设立的，TCP传输丢失数据时需要重新传输，那么之前传输的数据（丢失的数...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"15 套接字和标准I/O\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-12-30T14:17:30.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"mingStudent\\"}]}"],["meta",{"property":"og:url","content":"https://guzhoutingxue.github.io/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15%20%E5%A5%97%E6%8E%A5%E5%AD%97%E5%92%8C%E6%A0%87%E5%87%86IO.html"}],["meta",{"property":"og:title","content":"15 套接字和标准I/O"}],["meta",{"property":"og:description","content":"15 套接字和标准I/O 标准I/O函数的优点 标准I/O函数和非标准I/O函数的区别 标准：按照ANSI C标准定义，具有良好的移植性 带缓冲：标准I/O函数带有输入、输出缓冲，能够提高性能 socket缓冲和标准I/O缓冲区别： socket 缓冲的主要目的是为了实现TCP协议而设立的，TCP传输丢失数据时需要重新传输，那么之前传输的数据（丢失的数..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-12-30T14:17:30.000Z"}],["meta",{"property":"article:modified_time","content":"2025-12-30T14:17:30.000Z"}]]},"git":{"createdTime":1767104250000,"updatedTime":1767104250000,"contributors":[{"name":"guZhouTingXue","username":"guZhouTingXue","email":"2422173022@qq.com","commits":1,"url":"https://github.com/guZhouTingXue"}]},"readingTime":{"minutes":3.94,"words":1183},"filePathRelative":"网络编程/15 套接字和标准IO.md","excerpt":"","autoDesc":true}');export{m as comp,f as data};
